---
title: "Explorando a APi"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r, warning=FALSE}
library(tidyverse)
library(lubridate)
library(jsonlite)
library(zoo)
#devtools::install_github("juliasilge/silgelib")
library(silgelib)
theme_set(theme_roboto())
# These fonts must be installed locally on your computer for this theme to work: https://fonts.google.com/specimen/Roboto+Condensed and https://fonts.google.com/specimen/Roboto. 
```

```{r ler}
recentes_raw = fromJSON("http://150.165.85.12:41205/get_today_people_count") %>% 
    as.tibble() 

recentes = recentes_raw %>% 
    transmute(t = ymd_hms(timestamps), 
              macs = data)
```

```{r filtrar}
macs_fixos = recentes %>% 
    filter(hour(t) %in% 1:4) %>% 
    summarise(fixos = quantile(macs, 0.8)[[1]])

recentes = recentes %>% 
    group_by(t) %>% 
    mutate(pessoas = max(0, macs - macs_fixos$fixos)) %>% 
    ungroup() %>% 
    mutate(pessoas_mm = rollapply(pessoas, 3 , mean, align='right', fill=NA))

```

# Quantos somos?

```{r}
recentes %>% 
    ggplot(aes(x = t, y = pessoas_mm)) + 
    geom_line(color = "grey") + 
    geom_point(color = "darkred") + 
    #geom_smooth(method = "loess", se = F) + 
    labs(title = "Movimento, pessoas, vida",
         subtitle = "Quantas pesssoas ao longo do tempo?") 
```


```{r}

```
